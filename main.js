(()=>{"use strict";var e=function(e,r,o){o.validity.valid?n(e,r,o):t(e,r,o,o.validationMessage)},t=function(e,t,n,r){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),o.textContent=r,o.classList.add(e.errorClass)},n=function(e,t,n){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),r.classList.remove(e.errorClass),r.textContent=""},r=function(e,t,n){o(t)?(n.classList.add(e.inactiveButtonClass),n.disabled=!0):(n.classList.remove(e.inactiveButtonClass),n.disabled=!1)},o=function(e){return e.some((function(e){return!e.validity.valid}))},c=function(e,t){var o=Array.from(t.querySelectorAll(e.inputSelector)),c=t.querySelector(e.submitButtonSelector);r(e,o,c),o.forEach((function(r){n(e,t,r)}))},a=document.querySelector(".page"),i={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},s=document.querySelectorAll(".popup"),u=a.querySelector(".popup_type_preview"),l=u.querySelector(".preview__image"),d=u.querySelector(".preview__caption");function f(e){document.addEventListener("keydown",m),e.classList.add("popup_opened")}function p(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",m)}function m(e){"Escape"===e.key&&p(document.querySelector(".popup_opened"))}function _(e){if(e.ok)return e.json();Promise.reject("Ошибка: ".concat(e.status))}s.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&p(e),t.target.classList.contains("popup__close-button")&&p(e)}))}));var v={baseUrl:"https://nomoreparties.co/v1/plus-cohort-8",headers:{authorization:"6556f7bd-6f48-4334-a44b-f6f6033ed762","Content-Type":"application/json"}},h=a.querySelector("#card-template").content;function y(e,t,n,r,o,c,a){var i=h.querySelector(".card").cloneNode(!0),s=i.querySelector(".card__photo"),p=i.querySelector(".card__like-counter");s.src=t,s.alt=n,p.innerText=r,i.querySelector(".card__caption").textContent=e;var m=i.querySelector(".card__like");a&&m.classList.add("card__like_active"),m.addEventListener("click",(function(e){e.target.classList.contains("card__like_active")?function(e){return fetch("".concat(v.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:v.headers}).then(_)}(c).then((function(t){p.innerText=t.likes.length,e.target.classList.remove("card__like_active")})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(v.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:v.headers}).then(_)}(c).then((function(t){p.innerText=t.likes.length,e.target.classList.add("card__like_active")})).catch((function(e){return console.log(e)}))}));var y=i.querySelector(".card__bin-icon");return o?y.addEventListener("click",(function(e){(function(e){return fetch("".concat(v.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:v.headers}).then(_)})(c).then((function(){e.target.closest(".card").remove()})).catch((function(e){return console.log(e)}))})):y.classList.add("card__bin-icon_disabled"),s.addEventListener("click",(function(){!function(e,t,n){l.src=t,l.alt=n,d.textContent=e,f(u)}(e,t,n)})),i}var S=a.querySelector(".cards__list"),b=a.querySelector(".profile__user-name"),q=a.querySelector(".profile__user-job"),L=a.querySelector(".profile__avatar"),g=a.querySelector(".popup_type_add"),E=a.querySelector(".popup_type_edit"),k=a.querySelector(".popup_type_avatar"),C=a.querySelector(".profile__edit-button"),x=a.querySelector(".profile__add-button"),T=a.querySelector(".profile__avatar-overlay"),B=a.querySelector(".popup_type_edit .form"),U=a.querySelector(".popup_type_add .form"),A=a.querySelector(".popup_type_avatar .form");C.addEventListener("click",(function(){var e=document.forms.editForm;e.elements.userName.value=b.textContent,e.elements.userInfo.value=q.textContent,f(E),c(i,E)})),x.addEventListener("click",(function(){U.reset(),f(g),c(i,g)})),T.addEventListener("click",(function(){A.reset(),f(k),c(i,k)})),B.addEventListener("submit",(function(e){var t,n;e.preventDefault(),B.elements.submitButton.innerText="Сохранение...",(t=e.target.elements.userName.value,n=e.target.elements.userInfo.value,fetch("".concat(v.baseUrl,"/users/me"),{method:"PATCH",headers:v.headers,body:JSON.stringify({name:t,about:n})}).then(_)).then((function(e){b.textContent=e.name,q.textContent=e.about,p(E)})).catch((function(e){return console.log(e)})).finally((function(){B.elements.submitButton.innerText="Сохранить"}))})),U.addEventListener("submit",(function(e){var t,n;e.preventDefault(),U.elements.submitButton.innerText="Сохранение...",(t=e.target.elements.cardName.value,n=e.target.elements.cardUrl.value,fetch("".concat(v.baseUrl,"/cards"),{method:"POST",headers:v.headers,body:JSON.stringify({name:t,link:n})}).then(_)).then((function(e){S.prepend(y(e.name,e.link,e.name,e.likes.length,!0,e._id,!1)),p(g)})).catch((function(e){return console.log(e)})).finally((function(){U.elements.submitButton.innerText="Сохранить"}))})),A.addEventListener("submit",(function(e){var t;e.preventDefault(),A.elements.submitButton.innerText="Сохранение...",(t=e.target.elements.avatarUrl.value,fetch("".concat(v.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:v.headers,body:JSON.stringify({avatar:t})}).then(_)).then((function(e){L.src=e.avatar,p(k)})).catch((function(e){return console.log(e)})).finally((function(){A.elements.submitButton.innerText="Сохранить"}))})),fetch("".concat(v.baseUrl,"/users/me"),{headers:v.headers}).then(_).then((function(e){var t,n;b.textContent=e.name,q.textContent=e.about,L.src=e.avatar,t=S,n=e._id,fetch("".concat(v.baseUrl,"/cards"),{headers:v.headers}).then(_).then((function(e){for(var r=Object.keys(e).length-1;r>=0;r--){var o=e[r].name,c=e[r].link,a=e[r].name,i=e[r].likes.length,s=n==e[r].owner._id,u=!!e[r].likes.some((function(e){return e._id===n})),l=e[r]._id;t.prepend(y(o,c,a,i,s,l,u))}})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var o=Array.from(t.querySelectorAll(n.inputSelector)),c=t.querySelector(n.submitButtonSelector);o.forEach((function(a){a.addEventListener("input",(function(){e(n,t,a),r(n,o,c)}))}))}(n,t)}))}(i)})();